#! /bin/sh -
#
# dbus/rc.main
#
# D-Bus daemon.
#

# Redirects the standard error to the standard output
exec 2>&1

TARGET="$1"
SVNAME="${2:-dbus}"

start()
{
    echo "*** ${SVNAME}: Starting dbus ..."

    mkdir -p /var/lib/dbus /run/dbus
    chown messagebus /var/lib/dbus
    rm -f /run/dbus/pid

    # Validate or generate unique ID file (/var/lib/dbus/machine-id)
    /usr/bin/dbus-uuidgen --ensure && {
     chmod 600 /var/lib/dbus/machine-id
     ln -sf /var/lib/dbus/machine-id /etc/machine-id
    }

    exec /usr/bin/dbus-daemon --nofork --system --nopidfile
}

reset()
{
    case $3 in
    exit)
        echo "*** ${SVNAME}: Exited status $4"
        ;;
    signal)
        echo "*** ${SVNAME}: Killed on signal $5"
        ;;
    *)
        echo "*** ${SVNAME}: Stopped (${3})"
        ;;
    esac
}

# Branch to target
eval ${TARGET} "$@"

