# This file is part of the 'dragora-installer'.
#
# Purpose: To install .tlz packages from chosen series.

dialog --colors \
 --backtitle "\ZbInstallation mode" \
 --title "SELECT THE INSTALLATION MODE" \
 --no-cancel --menu "" 7 66 0 \
"All"     "Install packages from selected series" \
"Expert"  "Select packages from chosen series" \
 2> ${SUBTMPDIR}/return-InstallPackages

dialog --clear

# Check for selected options
case "$(cat -- ${SUBTMPDIR}/return-InstallPackages)" in
All)
    echo "" > ${SUBTMDPIR}/return-InstallPackages_All;		# Clean up file.
    echo "" >> ${SUBTMPDIR}/return-ShowSeries;			# Append new line for reading.
    IFS= read -r REPLY < ${SUBTMPDIR}/return-ShowSeries;	# Read selected series.
    for series in $REPLY
    do
        find "${MEDIUM_SOURCE}"/noarch/$series "${MEDIUM_SOURCE}"/@ARCH@/$series \
         -type f -name '*.tlz' >> ${SUBTMPDIR}/return-InstallPackages_All \
          2> /dev/null || true
    done
    unset REPLY series

    # Proceed to install the packages with an ordered list

    LC_COLLATE=C sort -u ${SUBTMPDIR}/return-InstallPackages_All \
     > ${SUBTMPDIR}/return-InstallPackages_All.sorted 2> /dev/null || true

    if test -s ${SUBTMPDIR}/return-InstallPackages_All.sorted
    then
        qi -r /media/dragora-root -P /usr/pkg -t / -i - \
         < ${SUBTMPDIR}/return-InstallPackages_All.sorted
    else
        echo "${PROGRAM}: Error the package list is empty." 1>&2
        exit 99;
    fi
    ;;
Expert)
    :
    ;;
esac

