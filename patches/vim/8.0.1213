To: vim_dev@googlegroups.com
Subject: Patch 8.0.1213
Fcc: outbox
From: Bram Moolenaar <Bram@moolenaar.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
------------

Patch 8.0.1213
Problem:    Setting 'mzschemedll' has no effect.
Solution:   Move loading .vimrc to before call to mzscheme_main().
Files:      src/main.c


*** ../vim-8.0.1212/src/main.c	2017-09-27 21:46:12.419402953 +0200
--- src/main.c	2017-10-22 20:53:11.847307832 +0200
***************
*** 403,414 ****
--- 403,428 ----
      debug_break_level = params.use_debug_break_level;
  #endif
  
+     /* Reset 'loadplugins' for "-u NONE" before "--cmd" arguments.
+      * Allows for setting 'loadplugins' there. */
+     if (params.use_vimrc != NULL
+ 	    && (STRCMP(params.use_vimrc, "NONE") == 0
+ 		|| STRCMP(params.use_vimrc, "DEFAULTS") == 0))
+ 	p_lpl = FALSE;
+ 
+     /* Execute --cmd arguments. */
+     exe_pre_commands(&params);
+ 
+     /* Source startup scripts. */
+     source_startup_scripts(&params);
+ 
  #ifdef FEAT_MZSCHEME
      /*
       * Newer version of MzScheme (Racket) require earlier (trampolined)
       * initialisation via scheme_main_setup.
       * Implement this by initialising it as early as possible
       * and splitting off remaining Vim main into vim_main2().
+      * Do source startup scripts, so that 'mzschemedll' can be set.
       */
      return mzscheme_main();
  #else
***************
*** 427,445 ****
  vim_main2(void)
  {
  #ifndef NO_VIM_MAIN
-     /* Reset 'loadplugins' for "-u NONE" before "--cmd" arguments.
-      * Allows for setting 'loadplugins' there. */
-     if (params.use_vimrc != NULL
- 	    && (STRCMP(params.use_vimrc, "NONE") == 0
- 		|| STRCMP(params.use_vimrc, "DEFAULTS") == 0))
- 	p_lpl = FALSE;
- 
-     /* Execute --cmd arguments. */
-     exe_pre_commands(&params);
- 
-     /* Source startup scripts. */
-     source_startup_scripts(&params);
- 
  #ifdef FEAT_EVAL
      /*
       * Read all the plugin files.
--- 441,446 ----
*** ../vim-8.0.1212/src/version.c	2017-10-22 16:43:15.466595344 +0200
--- src/version.c	2017-10-22 20:54:13.714879145 +0200
***************
*** 763,764 ****
--- 763,766 ----
  {   /* Add new patch number below this line */
+ /**/
+     1213,
  /**/

-- 
Q:   How many hardware engineers does it take to change a lightbulb?
A:   None.  We'll fix it in software.

 /// Bram Moolenaar -- Bram@Moolenaar.net -- http://www.Moolenaar.net   \\\
///        sponsor Vim, vote for features -- http://www.Vim.org/sponsor/ \\\
\\\  an exciting new programming language -- http://www.Zimbu.org        ///
 \\\            help me help AIDS victims -- http://ICCF-Holland.org    ///
