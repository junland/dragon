To: vim_dev@googlegroups.com
Subject: Patch 8.0.1252
Fcc: outbox
From: Bram Moolenaar <Bram@moolenaar.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
------------

Patch 8.0.1252
Problem:    Incomplete translations makefile for MinGW/Cygwin.
Solution:   Add missing source files.  Make it work with msys2's bash. (Ken
            Takata)
Files:      src/po/Make_cyg.mak, src/po/Make_ming.mak, src/po/Make_mvc.mak


*** ../vim-8.0.1251/src/po/Make_cyg.mak	2015-12-29 16:00:09.000000000 +0100
--- src/po/Make_cyg.mak	2017-11-02 19:25:52.527382998 +0100
***************
*** 128,138 ****
  
  first_time:
  	$(XGETTEXT) --default-domain=$(LANGUAGE) \
! 		--add-comments --keyword=_ --keyword=N_ $(wildcard ../*.c) ../if_perl.xs $(wildcard ../globals.h)
  
  $(LANGUAGES):
  	$(XGETTEXT) --default-domain=$(PACKAGE) \
! 		--add-comments --keyword=_ --keyword=N_ $(wildcard ../*.c) ../if_perl.xs $(wildcard ../globals.h)
  	$(MV) $(PACKAGE).po $(PACKAGE).pot
  	$(CP) $@.po $@.po.orig
  	$(MV) $@.po $@.po.old
--- 128,138 ----
  
  first_time:
  	$(XGETTEXT) --default-domain=$(LANGUAGE) \
! 		--add-comments --keyword=_ --keyword=N_ $(wildcard ../*.c) ../if_perl.xs ../GvimExt/gvimext.cpp $(wildcard ../globals.h) ../if_py_both.h
  
  $(LANGUAGES):
  	$(XGETTEXT) --default-domain=$(PACKAGE) \
! 		--add-comments --keyword=_ --keyword=N_ $(wildcard ../*.c) ../if_perl.xs ../GvimExt/gvimext.cpp $(wildcard ../globals.h) ../if_py_both.h
  	$(MV) $(PACKAGE).po $(PACKAGE).pot
  	$(CP) $@.po $@.po.orig
  	$(MV) $@.po $@.po.old
*** ../vim-8.0.1251/src/po/Make_ming.mak	2015-12-29 16:00:09.000000000 +0100
--- src/po/Make_ming.mak	2017-11-02 19:25:52.527382998 +0100
***************
*** 11,17 ****
--- 11,21 ----
  #
  
  ifndef VIMRUNTIME
+ ifeq (sh.exe, $(SHELL))
  VIMRUNTIME = ..\..\runtime
+ else
+ VIMRUNTIME = ../../runtime
+ endif
  endif
  
  LANGUAGES = \
***************
*** 100,113 ****
--- 104,130 ----
  #GETTEXT_PATH = C:/gettext-0.10.35-w32/win32/Release/
  #GETTEXT_PATH = C:/cygwin/bin/
  
+ ifeq (sh.exe, $(SHELL))
  MSGFMT = set OLD_PO_FILE_INPUT=yes && $(GETTEXT_PATH)msgfmt -v
  XGETTEXT = set OLD_PO_FILE_INPUT=yes && set OLD_PO_FILE_OUTPUT=yes && $(GETTEXT_PATH)xgettext
  MSGMERGE = set OLD_PO_FILE_INPUT=yes && set OLD_PO_FILE_OUTPUT=yes && $(GETTEXT_PATH)msgmerge
+ else
+ MSGFMT = LANG=C OLD_PO_FILE_INPUT=yes $(GETTEXT_PATH)msgfmt -v
+ XGETTEXT = LANG=C OLD_PO_FILE_INPUT=yes OLD_PO_FILE_OUTPUT=yes $(GETTEXT_PATH)xgettext
+ MSGMERGE = LANG=C OLD_PO_FILE_INPUT=yes OLD_PO_FILE_OUTPUT=yes $(GETTEXT_PATH)msgmerge
+ endif
  
+ ifeq (sh.exe, $(SHELL))
  MV = move
  CP = copy
  RM = del
  MKD = mkdir
+ else
+ MV = mv -f
+ CP = cp -f
+ RM = rm -f
+ MKD = mkdir -p
+ endif
  
  .SUFFIXES:
  .SUFFIXES: .po .mo .pot
***************
*** 120,130 ****
  
  first_time:
  	$(XGETTEXT) --default-domain=$(LANGUAGE) \
! 		--add-comments --keyword=_ --keyword=N_ $(wildcard ../*.c) ../if_perl.xs $(wildcard ../globals.h)
  
  $(LANGUAGES):
  	$(XGETTEXT) --default-domain=$(PACKAGE) \
! 		--add-comments --keyword=_ --keyword=N_ $(wildcard ../*.c) ../if_perl.xs $(wildcard ../globals.h)
  	$(MV) $(PACKAGE).po $(PACKAGE).pot
  	$(CP) $@.po $@.po.orig
  	$(MV) $@.po $@.po.old
--- 137,147 ----
  
  first_time:
  	$(XGETTEXT) --default-domain=$(LANGUAGE) \
! 		--add-comments --keyword=_ --keyword=N_ $(wildcard ../*.c) ../if_perl.xs ../GvimExt/gvimext.cpp $(wildcard ../globals.h) ../if_py_both.h
  
  $(LANGUAGES):
  	$(XGETTEXT) --default-domain=$(PACKAGE) \
! 		--add-comments --keyword=_ --keyword=N_ $(wildcard ../*.c) ../if_perl.xs ../GvimExt/gvimext.cpp $(wildcard ../globals.h) ../if_py_both.h
  	$(MV) $(PACKAGE).po $(PACKAGE).pot
  	$(CP) $@.po $@.po.orig
  	$(MV) $@.po $@.po.old
***************
*** 136,145 ****
--- 153,170 ----
  	$(MKD) $(VIMRUNTIME)\lang\$(LANGUAGE)\LC_MESSAGES
  	$(CP) $(LANGUAGE).mo $(VIMRUNTIME)\lang\$(LANGUAGE)\LC_MESSAGES\$(PACKAGE).mo
  
+ ifeq (sh.exe, $(SHELL))
  install-all: all
  	FOR %%l IN ($(LANGUAGES)) DO @IF NOT EXIST $(VIMRUNTIME)\lang\%%l $(MKD) $(VIMRUNTIME)\lang\%%l
  	FOR %%l IN ($(LANGUAGES)) DO @IF NOT EXIST $(VIMRUNTIME)\lang\%%l\LC_MESSAGES $(MKD) $(VIMRUNTIME)\lang\%%l\LC_MESSAGES
  	FOR %%l IN ($(LANGUAGES)) DO @$(CP) %%l.mo $(VIMRUNTIME)\lang\%%l\LC_MESSAGES\$(PACKAGE).mo
+ else
+ install-all: all
+ 	for TARGET in $(LANGUAGES); do \
+ 		$(MKD) $(VIMRUNTIME)/lang/$$TARGET/LC_MESSAGES ; \
+ 		$(CP) $$TARGET.mo $(VIMRUNTIME)/lang/$$TARGET/LC_MESSAGES/$(PACKAGE).mo ; \
+ 	done
+ endif
  
  clean:
  	$(RM) *.mo
*** ../vim-8.0.1251/src/po/Make_mvc.mak	2015-12-29 16:00:09.000000000 +0100
--- src/po/Make_mvc.mak	2017-11-02 19:25:52.531382973 +0100
***************
*** 117,123 ****
  all: $(MOFILES)
  
  files:
! 	$(LS) $(LSFLAGS) ..\*.c ..\if_perl.xs ..\globals.h > .\files
  
  first_time: files
  	set OLD_PO_FILE_INPUT=yes
--- 117,123 ----
  all: $(MOFILES)
  
  files:
! 	$(LS) $(LSFLAGS) ..\*.c ..\if_perl.xs ..\GvimExt\gvimext.cpp ..\globals.h ..\if_py_both.h > .\files
  
  first_time: files
  	set OLD_PO_FILE_INPUT=yes
*** ../vim-8.0.1251/src/version.c	2017-11-02 19:22:58.664420704 +0100
--- src/version.c	2017-11-02 19:26:25.391184954 +0100
***************
*** 763,764 ****
--- 763,766 ----
  {   /* Add new patch number below this line */
+ /**/
+     1252,
  /**/

-- 
The Law, in its majestic equality, forbids the rich, as well as the
poor, to sleep under the bridges, to beg in the streets, and to steal
bread.                       -- Anatole France

 /// Bram Moolenaar -- Bram@Moolenaar.net -- http://www.Moolenaar.net   \\\
///        sponsor Vim, vote for features -- http://www.Vim.org/sponsor/ \\\
\\\  an exciting new programming language -- http://www.Zimbu.org        ///
 \\\            help me help AIDS victims -- http://ICCF-Holland.org    ///
