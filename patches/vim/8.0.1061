To: vim_dev@googlegroups.com
Subject: Patch 8.0.1061
Fcc: outbox
From: Bram Moolenaar <Bram@moolenaar.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
------------

Patch 8.0.1061
Problem:    Coverity: no check for NULL command.
Solution:   Check for NULL list item.
Files:      src/terminal.c


*** ../vim-8.0.1060/src/terminal.c	2017-09-03 20:59:36.026190759 +0200
--- src/terminal.c	2017-09-05 22:58:29.273423516 +0200
***************
*** 38,44 ****
   * in tl_scrollback are no longer used.
   *
   * TODO:
!  * - ":term NONE" does not work in MS-Windows.
   * - implement term_setsize()
   * - add test for giving error for invalid 'termsize' value.
   * - support minimal size when 'termsize' is "rows*cols".
--- 38,46 ----
   * in tl_scrollback are no longer used.
   *
   * TODO:
!  * - ":term NONE" does not work on MS-Windows.
!  *   https://github.com/vim/vim/pull/2056
!  * - Redirecting output does not work on MS-Windows.
   * - implement term_setsize()
   * - add test for giving error for invalid 'termsize' value.
   * - support minimal size when 'termsize' is "rows*cols".
***************
*** 56,61 ****
--- 58,65 ----
   * - In the GUI use a terminal emulator for :!cmd.
   * - Copy text in the vterm to the Vim buffer once in a while, so that
   *   completion works.
+  * - add an optional limit for the scrollback size.  When reaching it remove
+  *   10% at the start.
   */
  
  #include "vim.h"
***************
*** 366,375 ****
  	}
  	else if (argvar->v_type != VAR_LIST
  		|| argvar->vval.v_list == NULL
! 		|| argvar->vval.v_list->lv_len < 1)
  	    cmd = (char_u*)"";
- 	else
- 	    cmd = get_tv_string_chk(&argvar->vval.v_list->lv_first->li_tv);
  
  	len = STRLEN(cmd) + 10;
  	p = alloc((int)len);
--- 370,379 ----
  	}
  	else if (argvar->v_type != VAR_LIST
  		|| argvar->vval.v_list == NULL
! 		|| argvar->vval.v_list->lv_len < 1
! 		|| (cmd = get_tv_string_chk(
! 			       &argvar->vval.v_list->lv_first->li_tv)) == NULL)
  	    cmd = (char_u*)"";
  
  	len = STRLEN(cmd) + 10;
  	p = alloc((int)len);
*** ../vim-8.0.1060/src/version.c	2017-09-05 22:20:42.624382868 +0200
--- src/version.c	2017-09-05 22:59:30.465016402 +0200
***************
*** 771,772 ****
--- 771,774 ----
  {   /* Add new patch number below this line */
+ /**/
+     1061,
  /**/

-- 
hundred-and-one symptoms of being an internet addict:
88. Every single time you press the 'Get mail' button...it does get new mail.

 /// Bram Moolenaar -- Bram@Moolenaar.net -- http://www.Moolenaar.net   \\\
///        sponsor Vim, vote for features -- http://www.Vim.org/sponsor/ \\\
\\\  an exciting new programming language -- http://www.Zimbu.org        ///
 \\\            help me help AIDS victims -- http://ICCF-Holland.org    ///
