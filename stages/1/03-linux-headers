# Build script for linux-libre (headers)
#
# Copyright (C) 2014-2017 Matias Fonzo, <selk@dragora.org>
#
# This script is free software: you have unlimited permission
# to copy, distribute and modify it.

version=4.9.46

rm -rf -- "${TMPDIR}/linux-${version}"
untar \
 "${worktree}/sources/linux-libre-${version}-gnu.tar.lz" "$TMPDIR"

# Build instructions
cd -- "${TMPDIR}/linux-${version}"

make mrproper
make headers_check ARCH="$kernel_arch"
make headers_install ARCH="$kernel_arch" INSTALL_HDR_PATH=dest

# Copy headers
mkdir -p -- "${rootdir}/tools/include"
cp -r dest/include/* "${rootdir}/tools/include"

# Remove cruft
find "${rootdir}/tools/include" \
 -type f \( -name .install -o -name ..install.cmd \) -exec rm -f {} +

cleanup()
{
    cd -- "$TMPDIR" && rm -rf linux-*
}

